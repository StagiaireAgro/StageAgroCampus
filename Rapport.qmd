---
title: "PLAT4TERFOOD"
format: pdf
editor: visual
---
## Packages

```{r}
library(readxl)
library(dplyr)
library(tidyverse)
library(kableExtra)
```

## Imporation des données

```{r}

data <- read_excel("24407_Export.xlsx")

```

## Questions :

### 1.Pour chaque lieu. Expression des fréquences des courses (Q6)
#### Avec usage de library

-   (1)On sélectionne les données qui nous intéressent avec la fonction `select()` dans le dataframe de base ( On sélectionne les données de la colonne Q6_1 à Q6_12 ). Pour travailler faire une action sur notre dataframe on l'outil `%>%` de la library dplyr

-   (2)On fait une mise au format long de notre nouveau dataframe à l’aide de la fonction `pivot_longer()` de la library tidyverse.

-   (3)On passe toute les données en type facteur à l'aide de la fonction `factor()` où l'on définit les levels et les labels associés.

-   (4)A l’aide de la fonction `table()` on fait un tableau de fréquence en fonction des catégories croisés ( le lieux d’achat croisé avec sa régularité de fréquentation ).

-   (5)A partir de ce tableau on calcul les proportion d'individu en fonction des catégories croisés que l'on multipli par 100 pour avoir des pourcentages à l'aide de la fonction `prop.table()`. On arrondi à deux chiffres après la virgule avec la fonction `round()`.

-   (6)Avec la fonction `kable()` du package KableExtra on met en forme ce tableau. On lui ajoute un style avec la fonction `kable_styling()` et on ajoute une note de fin de page avec la fonction `footnote()` qu l'on applique à kable à l'aide la `%>%`.

```{r}
#(1)
  
df_Q6 <- data %>%      
  select(Q6_1:Q6_12) 

#(2)

df_Q6_L <- df_Q6 %>%  pivot_longer(cols = Q6_1:Q6_12,
                          names_to = "Q6",
                          values_to = "value")

#(3)

df_Q6_L$Q6 <- factor(df_Q6_L$Q6, levels = paste("Q6_", seq(1:12), sep = ""), labels = c("Hypermarché, Supermarché","Hard discount","Epiceries indépendantes, de quartier, épiceries fines","Magasins de surgelés","Magasins spécialisés Bio","Marché","Directement aux agriculteurs","Paniers en ligne réalisés par un intermédiaire","Artisans et commerçants spécialisés","Epicerie participative, associative, supermarché coopératif","Magasin alimentaire spécialisé dans le vrac ou les produits locaux","Magasin d’aide alimentaire"))

df_Q6_L$value <- factor(df_Q6_L$value, levels = 1:7, labels = c("Plusieurs fois par semaine","1 fois par semaine","2 à 3 fois par mois","1 fois par mois","Moins d’une fois par mois","Seulement pour des événements particuliers","Jamais"))

#(4)

df_Q6_freq <- table(df_Q6_L$Q6, fc$value)

#(5)

df_Q6_prop <- round(prop.table(df_Q6_freq,1)*100, 2)

#(6)

kable(df_Q6_prop, captation = "Taux de réquentation en fonction des lieux d'achat" ) %>% # mise en forme du tableau
  kable_styling(latex_options = "striped") %>%
  footnote(general = "Format des données en pourcentage",
           general_title = "Note: ",)
```

### 2.Nombre de lieux fréquentés très régulièrement (réponses 1/2) en moyenne

#### Usage de R natif

- (1)On sélectionne les données qui nous intéressent avec la fonction `select()` dans le dataframe de base ( On sélectionne les données de la colonne Q6_1 à Q6_12 ). 

- (2)On regarde pour chaque individu pour chaque lieu si il  est très fréquenté ( = 1 ou = 2). cela nous retourne le dataframe de booléens (0 = False ou 1 = True) . Il nous reste à sommer par ligne à l'aide de la fonction `rowSums()`

- (3)Pour afficher notre résultat on utilise la fontion `print()` à laquel on donne comme argument notre collage de à de la fonction `paste()` pour intégrer la moyenne arrondi à un chiffre après la virgule de notre moyenne du nombre de lieux très fréquenté
```{r}

#(1)

dt_nb_moy <- select(data, Q6_1:Q6_12)

#(2)

nb_tres_freq <- rowSums(dt_nb_moy == 1 | dt_nb_moy == 2)

#(3)

print(paste("Les répondants fréquentent en moyenne ",round(mean(nb_tres_freq),1),
            " lieux très régulièrement (au moins une fois par semaine)"))
```

### 3.Répartition des répondants selon le nombre de lieux fréquentés très régulièrement

```{r}

df_nb_tres_freq <- as.data.frame(table(nb_tres_freq)) # On compte le nombre d'occurence par nb de lieux très fréquenté

dt_nb_tres_freq_pourcent <- round(prop.table(table(nb_tres_freq))*100,2) # On tranforme la fréquence en %

names(dimnames(dt_nb_tres_freq_pourcent)) <- "Nombre de lieux très fréquenté"

kable(dt_nb_tres_freq_pourcent)  #  mise en forme du tableau



ggplot(df_nb_tres_freq, aes(x = nb_tres_freq, y = Freq)) +
  geom_bar(stat = "identity")+
  labs(title = "fréquence par nombre lieux très fréquenté", x = "Nombre de lieux très fréquenté")
  
```

### 4.Nombre de lieux fréquentés régulièrement (réponses 1/2/3/4) en moyenne

```{r}
dt_nb_moy <- data %>% # selection des bonnes colonnes
  select(Q6_1:Q6_12)

nb_rgl_freq <- rowSums(dt_nb_moy == 1 | dt_nb_moy == 2 | dt_nb_moy == 3 | dt_nb_moy == 4) # On compte le nombre de lieu régulièrement fréquenté par individu

print(paste("Les répondants fréquentent en moyenne ",round(mean(nb_rgl_freq),1)," lieux régulièrement (au moins une fois par mois)"))
```

### 5. Répartition des répondants selon le nombre de lieux fréquentés régulièrement

```{r}

df_nb_rgl_freq <- as.data.frame(table(nb_rgl_freq)) # On compte le nombre d'occurence par nb de lieux régulièrement fréquenté

dt_nb_rgl_freq_pourcent <- round(prop.table(table(nb_rgl_freq))*100,2) # On tranforme la fréquence en %

names(dimnames(dt_nb_rgl_freq_pourcent)) <- "Nombre de lieux régulièrement fréquenté"

kable(dt_nb_rgl_freq_pourcent)  #  mise en forme du tableau



ggplot(df_nb_rgl_freq, aes(x = nb_rgl_freq, y = Freq)) +
  geom_bar(stat = "identity")+
  labs(title = "fréquence par nombre lieux régulièrement fréquenté", x = "Nombre de lieux régulièrement fréquenté")

```


